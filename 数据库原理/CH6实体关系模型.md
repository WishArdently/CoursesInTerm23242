## CH6 Entity-Relational Model实体关系模型

*tips ：这部分的课件上内容异常抽象，请结合自身经验辩证对待这部分内容*

### 一、E/R Model

#### 1. 定义

Relationships : 联系

Entity : A movie, A star, A studio

Entity set : {movies} {stars} {studios}

#### 2. 联系

如StarsIn

#### 3. E/R图

>实体集：矩形
>
>属性：椭圆
>
>联系：菱形

键的描述下面画横线

#### 4. 多路联系

箭头指向"1"的一方

#### 5. 设计原则

>忠实性（准确）
>
>避免冗余
>
>简单性
>
>正确的联系
>
>选择正确的元素种类

### 二、 Constraints in the E/R Model

#### 1. 键约束

每一个实体必须包含一个键，从键中选择一个作为主键，只有能够形成键的属性集才能派生子类

#### 2. 存在约束

圆箭头：对于$E -R\to F$

E必须存在

#### 3. 程度约束

可以在关系边上靠近需要约束的一侧加上形如$\le 10$之类的约束

#### 4. 参照完整性

外键约束。

### 三、Weak Entity Sets

#### 1. 定义

任何属性集都不能独立成键，键中必须包含另一个实体集的属性

#### 2. 特点

>- 0个或多个属于自己的属性
>- 拥有来自多对一关系实体集的键属性
>  - 此时多对一关系称为*支持联系(supporting relationships)*
>  - 支持弱实体集的实体集称为*支持实体集(supporting entity sets)*

成为支持联系的关系必须拥有以下性质：

- R必须成为二元，多对一关系

- R必须拥有参照完整性
- 作为给弱实体集的键的属性必须是R的键
- 弱实体集之间传递的属性必须是键（递归性）

#### 3. 记号

- 弱实体集使用双矩形
- 支持联系使用双菱形
- 支持弱实体集的键属性，需要加下划线

### 四、E/R Diagrams to Relational Designs

#### 1. 特殊情况

> - 弱实体集无法直接转化为关系
> - Isa关系和子类需要特殊关照
> - 需要妥善处理多对一关系的实体的合并

#### 2. 实体关系到关系

对每个非实体集，保留所有属性

对两个实体集间的关系，添加两个实体集的键以及关系本身的属性到关系本身的schema。

#### 3. 合并关系

对于多对一关系：$E-R\to F$

合并时需要保留：

>E的所有属性
>
>F的键
>
>属于关系R的属性

#### 4. 处理弱实体集

>- 弱实体集W必须包含W的所有属性和支持集的键
>- 出现弱实体集W的任意关系必须将其所有关键属性用作 W 的键，包括对 W 键有贡献的其他实体集的键
>- 从弱实体集W到支持实体集，不需要完全转化为关系

若W是一个弱实体集，为W创建一个包含以下属性的关系模式：

>* W的所有属性
>* 支持W的所有属性（？？？？）
>* 假设W对E是多对一关系，需要添加E的主键

随时重命名防止冲突

不要创建任何支持关系。

### 五、Converting Subclass Structures to Relations

#### 1. 设计原则

>- 一个实体对应一张表
>- 一对一关系，分配到任意表中
>- 一对多关系，即可分配到“多”的表中，也可成独立关系
>- 多对多关系，必须使用单独关系表展示，两个实体表的主键合起来作为关系表的主键 



